<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="متجر إلكتروني لبيع الإكسسوارات: ساعات، أساور، خواتم، ميداليات">
    <meta name="author" content="Your Name">
    <title>متجر الإكسسوارات - تسوق الآن</title>

    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">

    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&display=swap" rel="stylesheet">

    <!-- Custom CSS -->
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: 'Cairo', sans-serif;
            background: #f4f4f4;
            direction: rtl;
            text-align: right;
        }

        /* Navbar */
        .navbar {
            background: #232f3e;
            color: #fff;
            padding: 10px 20px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            position: sticky;
            top: 0;
            z-index: 1000;
        }

        .navbar .logo {
            font-size: 24px;
            font-weight: bold;
        }

        .navbar .search-bar {
            flex-grow: 1;
            margin: 0 20px;
            position: relative;
        }

        .navbar .search-bar input {
            width: 100%;
            padding: 10px 40px 10px 20px;
            border: none;
            border-radius: 5px;
            font-size: 16px;
        }

        .navbar .search-bar i {
            position: absolute;
            right: 10px;
            top: 50%;
            transform: translateY(-50%);
            color: #999;
        }

        .navbar .nav-links {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .navbar .nav-links a {
            color: #fff;
            text-decoration: none;
            font-size: 16px;
            transition: color 0.3s;
        }

        .navbar .nav-links a:hover {
            color: #f0c14b;
        }

        .navbar .cart {
            position: relative;
        }

        .navbar .cart .cart-count {
            position: absolute;
            top: -10px;
            right: -10px;
            background: #f0c14b;
            color: #232f3e;
            border-radius: 50%;
            padding: 2px 6px;
            font-size: 12px;
        }

        .user-profile {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .user-profile img {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            object-fit: cover;
        }

        /* Main Content */
        .main-content {
            max-width: 1200px;
            margin: 20px auto;
            padding: 0 20px;
        }

        /* Categories */
        .categories {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 40px;
        }

        .category-card {
            background: #fff;
            border-radius: 10px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            text-align: center;
            padding: 20px;
            transition: transform 0.3s;
            cursor: pointer;
        }

        .category-card:hover {
            transform: translateY(-5px);
        }

        .category-card img {
            width: 100%;
            height: 150px;
            object-fit: cover;
            border-radius: 5px;
            margin-bottom: 10px;
        }

        .category-card h3 {
            font-size: 18px;
            color: #232f3e;
        }

        /* Products */
        .products {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
        }

        .product-card {
            background: #fff;
            border-radius: 10px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            padding: 20px;
            text-align: center;
            transition: transform 0.3s;
            cursor: pointer;
        }

        .product-card:hover {
            transform: translateY(-5px);
        }

        .product-card img {
            width: 100%;
            height: 200px;
            object-fit: cover;
            border-radius: 5px;
            margin-bottom: 10px;
        }

        .product-card h3 {
            font-size: 16px;
            color: #232f3e;
            margin-bottom: 10px;
        }

        .product-card .price {
            color: #B12704;
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .product-card .add-to-cart {
            background: #f0c14b;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            font-size: 14px;
            cursor: pointer;
            transition: background 0.3s;
        }

        .product-card .add-to-cart:hover {
            background: #e0b038;
        }

        /* Product Detail */
        .product-detail {
            display: none;
            background: #fff;
            border-radius: 10px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            padding: 20px;
            margin-bottom: 20px;
        }

        .product-detail .product-image {
            width: 100%;
            max-width: 400px;
            height: auto;
            border-radius: 5px;
            margin-bottom: 20px;
        }

        .product-detail h2 {
            font-size: 24px;
            color: #232f3e;
            margin-bottom: 10px;
        }

        .product-detail .price {
            color: #B12704;
            font-size: 22px;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .product-detail .description {
            font-size: 16px;
            color: #555;
            margin-bottom: 20px;
        }

        .product-detail .add-to-cart {
            background: #f0c14b;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            font-size: 14px;
            cursor: pointer;
            transition: background 0.3s;
        }

        .product-detail .add-to-cart:hover {
            background: #e0b038;
        }

        /* Cart */
        .cart-container {
            display: none;
            background: #fff;
            border-radius: 10px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            padding: 20px;
            margin-bottom: 20px;
        }

        .cart-item {
            display: flex;
            align-items: center;
            gap: 20px;
            padding: 10px 0;
            border-bottom: 1px solid #eee;
        }

        .cart-item img {
            width: 80px;
            height: 80px;
            object-fit: cover;
            border-radius: 5px;
        }

        .cart-item h3 {
            font-size: 16px;
            color: #232f3e;
            flex-grow: 1;
        }

        .cart-item .price {
            color: #B12704;
            font-size: 16px;
        }

        .cart-item .quantity {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .cart-item .quantity button {
            background: #ddd;
            border: none;
            padding: 5px 10px;
            cursor: pointer;
            border-radius: 5px;
        }

        .cart-item .remove {
            background: #B12704;
            color: #fff;
            border: none;
            padding: 5px 10px;
            border-radius: 5px;
            cursor: pointer;
        }

        .cart-total {
            font-size: 18px;
            font-weight: bold;
            text-align: left;
            margin-top: 20px;
        }

        .checkout-btn {
            background: #f0c14b;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            font-size: 16px;
            cursor: pointer;
            margin-top: 10px;
            transition: background 0.3s;
        }

        .checkout-btn:hover {
            background: #e0b038;
        }

        /* Guest Mode Warning */
        .guest-warning {
            background: #fff3cd;
            color: #856404;
            padding: 10px;
            border-radius: 5px;
            margin-bottom: 20px;
            display: none;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .navbar {
                flex-direction: column;
                gap: 10px;
            }

            .navbar .search-bar {
                margin: 10px 0;
            }

            .navbar .nav-links {
                flex-direction: column;
                gap: 10px;
            }

            .categories {
                grid-template-columns: 1fr;
            }

            .products {
                grid-template-columns: 1fr;
            }

            .product-detail .product-image {
                max-width: 100%;
            }
        }

        /* Loading Spinner */
        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #f0c14b;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 20px auto;
            display: none;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <!-- Navbar -->
    <nav class="navbar">
        <div class="logo">متجر الإكسسوارات</div>
        <div class="search-bar">
            <input type="text" id="searchInput" placeholder="ابحث عن المنتجات...">
            <i class="fas fa-search"></i>
        </div>
        <div class="nav-links">
            <div class="user-profile" id="userProfile">
                <span id="userName">وضع الضيف</span>
                <img id="userImage" src="https://via.placeholder.com/40" alt="صورة المستخدم" style="display: none;">
            </div>
            <a href="#" id="loginLink">تسجيل الدخول</a>
            <a href="#" id="logoutLink" style="display: none;">تسجيل الخروج</a>
            <a href="#" class="cart" id="cartLink">
                <i class="fas fa-shopping-cart"></i>
                <span class="cart-count" id="cartCount">0</span>
            </a>
        </div>
    </nav>

    <!-- Main Content -->
    <div class="main-content">
        <div class="guest-warning" id="guestWarning">
            أنت في وضع الضيف. قم بتسجيل الدخول للاستمتاع بجميع المزايا مثل الشراء وعرض التفاصيل الكاملة.
        </div>

        <!-- Categories -->
        <div class="categories" id="categories">
            <div class="category-card" data-category="watches">
                <img src="https://via.placeholder.com/200x150?text=ساعات" alt="ساعات">
                <h3>ساعات</h3>
            </div>
            <div class="category-card" data-category="bracelets">
                <img src="https://via.placeholder.com/200x150?text=أساور" alt="أساور">
                <h3>أساور</h3>
            </div>
            <div class="category-card" data-category="rings">
                <img src="https://via.placeholder.com/200x150?text=خواتم" alt="خواتم">
                <h3>خواتم</h3>
            </div>
            <div class="category-card" data-category="medals">
                <img src="https://via.placeholder.com/200x150?text=ميداليات" alt="ميداليات">
                <h3>ميداليات</h3>
            </div>
        </div>

        <!-- Products -->
        <div class="products" id="products"></div>

        <!-- Product Detail -->
        <div class="product-detail" id="productDetail"></div>

        <!-- Cart -->
        <div class="cart-container" id="cartContainer">
            <h2>عربة التسوق</h2>
            <div id="cartItems"></div>
            <div class="cart-total" id="cartTotal">الإجمالي: 0 ريال</div>
            <button class="checkout-btn" id="checkoutBtn">إتمام الشراء</button>
        </div>

        <!-- Spinner -->
        <div class="spinner" id="spinner"></div>
    </div>

    <!-- Firebase SDK -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
        import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";

        const firebaseConfig = {
            apiKey: "AIzaSyBfXJ-2tmCYo-pQjfN_4nAdxC-NcqfjAlo",
            authDomain: "tamec-8f9ea.firebaseapp.com",
            projectId: "tamec-8f9ea",
            storageBucket: "tamec-8f9ea.firebasestorage.app",
            messagingSenderId: "372610375354",
            appId: "1:372610375354:web:1beaff9695e7b49cdeec83",
            measurementId: "G-W7TT6VTKSP"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
    </script>

    <!-- JavaScript -->
    <script>
        // DOM Elements
        const searchInput = document.getElementById('searchInput');
        const categories = document.getElementById('categories');
        const products = document.getElementById('products');
        const productDetail = document.getElementById('productDetail');
        const cartContainer = document.getElementById('cartContainer');
        const cartItems = document.getElementById('cartItems');
        const cartTotal = document.getElementById('cartTotal');
        const cartCount = document.getElementById('cartCount');
        const checkoutBtn = document.getElementById('checkoutBtn');
        const loginLink = document.getElementById('loginLink');
        const logoutLink = document.getElementById('logoutLink');
        const cartLink = document.getElementById('cartLink');
        const userProfile = document.getElementById('userProfile');
        const userName = document.getElementById('userName');
        const userImage = document.getElementById('userImage');
        const guestWarning = document.getElementById('guestWarning');
        const spinner = document.getElementById('spinner');

        // Sample Products
        const allProducts = [
            { id: 1, name: "ساعة ذكية", category: "watches", price: 299, image: "https://via.placeholder.com/250x200?text=ساعة+ذكية", description: "ساعة ذكية بميزات متقدمة" },
            { id: 2, name: "ساعة كلاسيكية", category: "watches", price: 199, image: "https://via.placeholder.com/250x200?text=ساعة+كلاسيكية", description: "ساعة أنيقة للمناسبات" },
            { id: 3, name: "أسورة جلدية", category: "bracelets", price: 99, image: "https://via.placeholder.com/250x200?text=أسورة+جلدية", description: "أسورة مصنوعة يدويًا" },
            { id: 4, name: "أسورة فضية", category: "bracelets", price: 149, image: "https://via.placeholder.com/250x200?text=أسورة+فضية", description: "أسورة فاخرة" },
            { id: 5, name: "خاتم ذهبي", category: "rings", price: 249, image: "https://via.placeholder.com/250x200?text=خاتم+ذهبي", description: "خاتم بتصميم عصري" },
            { id: 6, name: "خاتم فضي", category: "rings", price: 179, image: "https://via.placeholder.com/250x200?text=خاتم+فضي", description: "خاتم أنيق" },
            { id: 7, name: "ميدالية ذهبية", category: "medals", price: 89, image: "https://via.placeholder.com/250x200?text=ميدالية+ذهبية", description: "ميدالية مميزة" },
            { id: 8, name: "ميدالية فضية", category: "medals", price: 69, image: "https://via.placeholder.com/250x200?text=ميدالية+فضية", description: "ميدالية كلاسيكية" },
        ];

        let cart = [];
        let isGuest = true;

        // Initialize Auth State
        auth.onAuthStateChanged(user => {
            if (user) {
                isGuest = false;
                userName.textContent = user.displayName || "مرحبًا";
                userImage.src = user.photoURL || "https://via.placeholder.com/40";
                userImage.style.display = 'block';
                loginLink.style.display = 'none';
                logoutLink.style.display = 'block';
                guestWarning.style.display = 'none';
                loadCart();
            } else {
                isGuest = true;
                userName.textContent = "وضع الضيف";
                userImage.style.display = 'none';
                loginLink.style.display = 'block';
                logoutLink.style.display = 'none';
                guestWarning.style.display = 'block';
                cart = [];
                updateCartUI();
            }
        });

        // Load Categories
        function loadCategories() {
            categories.style.display = 'grid';
            products.style.display = 'grid';
            productDetail.style.display = 'none';
            cartContainer.style.display = 'none';
            showProducts(allProducts);
        }

        // Show Products
        function showProducts(productList) {
            products.innerHTML = '';
            productList.forEach(product => {
                const productCard = document.createElement('div');
                productCard.className = 'product-card';
                productCard.innerHTML = `
                    <img src="${product.image}" alt="${product.name}">
                    <h3>${product.name}</h3>
                    <div class="price">${product.price} ريال</div>
                    <button class="add-to-cart" data-id="${product.id}" ${isGuest ? 'disabled' : ''}>إضافة إلى العربة</button>
                `;
                products.appendChild(productCard);
            });
        }

        // Filter Products by Category
        categories.addEventListener('click', e => {
            const category = e.target.closest('.category-card')?.dataset.category;
            if (category) {
                const filteredProducts = allProducts.filter(p => p.category === category);
                products.style.display = 'grid';
                categories.style.display = 'none';
                productDetail.style.display = 'none';
                cartContainer.style.display = 'none';
                showProducts(filteredProducts);
            }
        });

        // Show Product Detail
        products.addEventListener('click', e => {
            const productId = e.target.closest('.product-card')?.querySelector('.add-to-cart')?.dataset.id;
            if (productId) {
                const product = allProducts.find(p => p.id == productId);
                products.style.display = 'none';
                categories.style.display = 'none';
                cartContainer.style.display = 'none';
                productDetail.style.display = 'block';
                productDetail.innerHTML = `
                    <img class="product-image" src="${product.image}" alt="${product.name}">
                    <h2>${product.name}</h2>
                    <div class="price">${product.price} ريال</div>
                    <div class="description">${isGuest ? 'تسجيل الدخول لعرض التفاصيل' : product.description}</div>
                    <button class="add-to-cart" data-id="${product.id}" ${isGuest ? 'disabled' : ''}>إضافة إلى العربة</button>
                `;
            }
        });

        // Add to Cart
        document.addEventListener('click', e => {
            if (e.target.classList.contains('add-to-cart')) {
                if (isGuest) {
                    alert('يرجى تسجيل الدخول لإضافة المنتجات إلى العربة');
                    window.location.href = 'login.html';
                    return;
                }
                const productId = e.target.dataset.id;
                const product = allProducts.find(p => p.id == productId);
                const cartItem = cart.find(item => item.id == productId);
                if (cartItem) {
                    cartItem.quantity += 1;
                } else {
                    cart.push({ ...product, quantity: 1 });
                }
                updateCartUI();
            }
        });

        // Update Cart UI
        function updateCartUI() {
            cartItems.innerHTML = '';
            let total = 0;
            cart.forEach(item => {
                total += item.price * item.quantity;
                const cartItem = document.createElement('div');
                cartItem.className = 'cart-item';
                cartItem.innerHTML = `
                    <img src="${item.image}" alt="${item.name}">
                    <h3>${item.name}</h3>
                    <div class="price">${item.price} ريال</div>
                    <div class="quantity">
                        <button class="decrease" data-id="${item.id}">-</button>
                        <span>${item.quantity}</span>
                        <button class="increase" data-id="${item.id}">+</button>
                    </div>
                    <button class="remove" data-id="${item.id}">إزالة</button>
                `;
                cartItems.appendChild(cartItem);
            });
            cartTotal.textContent = `الإجمالي: ${total} ريال`;
            cartCount.textContent = cart.reduce((sum, item) => sum + item.quantity, 0);
        }

        // Cart Quantity Controls
        cartItems.addEventListener('click', e => {
            const id = e.target.dataset.id;
            if (e.target.classList.contains('increase')) {
                const item = cart.find(i => i.id == id);
                item.quantity += 1;
            } else if (e.target.classList.contains('decrease')) {
                const item = cart.find(i => i.id == id);
                if (item.quantity > 1) item.quantity -= 1;
                else cart = cart.filter(i => i.id != id);
            } else if (e.target.classList.contains('remove')) {
                cart = cart.filter(i => i.id != id);
            }
            updateCartUI();
        });

        // Show Cart
        cartLink.addEventListener('click', e => {
            e.preventDefault();
            if (isGuest) {
                alert('يرجى تسجيل الدخول لعرض عربة التسوق');
                window.location.href = 'login.html';
                return;
            }
            categories.style.display = 'none';
            products.style.display = 'none';
            productDetail.style.display = 'none';
            cartContainer.style.display = 'block';
        });

        // Checkout
        checkoutBtn.addEventListener('click', () => {
            if (cart.length === 0) {
                alert('عربة التسوق فارغة');
                return;
            }
            alert('تم إتمام الشراء بنجاح!');
            cart = [];
            updateCartUI();
            loadCategories();
        });

        // Search Functionality
        searchInput.addEventListener('input', () => {
            const query = searchInput.value.toLowerCase();
            const filteredProducts = allProducts.filter(p => p.name.toLowerCase().includes(query));
            products.style.display = 'grid';
            categories.style.display = 'none';
            productDetail.style.display = 'none';
            cartContainer.style.display = 'none';
            showProducts(filteredProducts);
        });

        // Login Link
        loginLink.addEventListener('click', e => {
            e.preventDefault();
            window.location.href = 'login.html';
        });

        // Logout
        logoutLink.addEventListener('click', async e => {
            e.preventDefault();
            try {
                await auth.signOut();
                window.location.href = 'index.html';
            } catch (error) {
                console.error('Error signing out:', error);
            }
        });

        // Load Cart from Local Storage (for persistence)
        function loadCart() {
            const savedCart = localStorage.getItem('cart');
            if (savedCart && !isGuest) {
                cart = JSON.parse(savedCart);
                updateCartUI();
            }
        }

        // Save Cart to Local Storage
        function saveCart() {
            if (!isGuest) {
                localStorage.setItem('cart', JSON.stringify(cart));
            }
        }

        // Update Cart on Change
        document.addEventListener('click', () => {
            saveCart();
        });

        // Initial Load
        loadCategories();
    </script>
</body>
</html>
